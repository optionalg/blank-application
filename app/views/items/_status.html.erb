<% item_class_name =  item.class.to_s.underscore %> 
	<%=	check_box_tag_name = "#{item_class_name}[associated_workspaces][]"
		# Checkboxes for associated WorkSpaces
		 (Workspace.allowed_user_with_permission(@current_user.id, item_class_name+"_new")).map{ |w| w.ws_config.ws_items.include?(item_class_name) ? w : nil }.collect do |w|

			checked =
				# Checked if related params...
				if params[item_class_name]
					if params[item_class_name]['associated_workspaces'] && params[item_class_name]['associated_workspaces'].include?(w.id.to_s)
						true
					else
						false
					end
				# ... or nested resource
				elsif item.workspaces.exists?(w.id) || (w.id == params[:workspace_id].to_i)
					true
				else
					false
				end
			
			# Out
            if (w.state == 'private')
              check_box_tag(check_box_tag_name, w.id, true, option = {:disabled => true, :class => 'checkBoxElement'}) + ' ' + w.title + hidden_field_tag(check_box_tag_name, w.id.to_s)
              
            else
              check_box_tag(check_box_tag_name, w.id, checked, :class => 'checkBoxElement') + ' ' + w.title
            end
		end.join('<br />') %>