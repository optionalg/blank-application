<div id="comments_list">
    <% if object.comments.size > 0 %>
      <h2><%= image_tag 'icons/comments.png'%><%=I18n.t('general.object.comment').pluralize.camelize %></h2>
      <div class="comment_bloc">
        <%= render :partial => "items/comment", :collection => object.comments %>
      </div>
    <% end %>
</div>

<div id="ajax_info"></div>
  <% if @current_object.accepts_comment_for?(@current_user) %>
    <div id ="reply" style="display:none">
      <fieldset id="new_comment_form_box">
        <p><%= I18n.t('general.common_word.your').camelize+ ' Reply'%> :</p>
        <div id="ajax_info"></div>
        <form id="new_comment" class="new_comment" onsubmit="if($('reply_box').value != 0){new Ajax.Request('<%=add_reply_comment_path(@current_object)%>', {asynchronous:true, evalScripts:true, onComplete:function(request){$('reply_box').writeAttribute('disabled', false);$('reply_box').value = ''}, onLoading:function(request){$('reply_box').writeAttribute('disabled')}, parameters:Form.serialize(this)}); return false;}else{return false;}" method="post" action="<%=add_reply_comment_path(@current_object)%>">
          <textarea id="reply_box" class="comment_box" rows="4" name="comment[text]" cols="90"></textarea>
          <% if !current_user %>
            <div id="captcha" style="width:30%">
              <%= render :partial => "/items/captcha" %>
            </div>
          <% end %>
          <input type="hidden" id ="comment_parent_id" name="comment[parent_id]">
          <button type="submit" class="submit_button"><%=I18n.t('comment.add_comment.button_publish')%></button>
        </form>
      </fieldset>
    </div>
  <% end %>
  <% if @current_object.accepts_comment_for?(@current_user) %>
    <fieldset id="new_comment_form_box">
      <p><%= I18n.t('general.common_word.your').camelize+' '+I18n.t('general.object.comment')%> :</p>
      <form id="new_comment" class="new_comment" onsubmit="if($('comment_box').value != 0){new Ajax.Request('<%=add_comment_item_path(@current_object)%>', {asynchronous:true, evalScripts:true, onComplete:function(request){$('comment_box').writeAttribute('disabled', false);$('comment_box').value = ''}, onLoading:function(request){$('comment_box').writeAttribute('disabled')}, parameters:Form.serialize(this)}); return false;}else{return false;}" method="post" action="<%=add_comment_item_path(@current_object)%>">
        <textarea id="comment_box" class="comment_box" rows="8" name="comment[text]" cols="90"></textarea>
        <% if !current_user %>
          <div id="captcha" style="width:30%">
            <%= render :partial => "/items/captcha" %>
          </div>
        <% end %>
        <button type="submit" class="submit_button"><%=I18n.t('comment.add_comment.button_publish')%></button>
      </form>
    </fieldset>
  <% end %>

<script type="text/javascript">
    function add_reply(parent){
      if($('reply')){
        $('reply').style.display = 'block';
        $('comment_parent_id').value = parent;
      }
    }
</script>